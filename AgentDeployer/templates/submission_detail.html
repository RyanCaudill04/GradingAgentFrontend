{% extends 'base.html' %}
{% load static %}

{% block title %}Submission Details{% endblock %}

{% block content %}
<div class="container">
    <h1>Submission Details</h1>

    {% if submission %}
    <div class="submission-detail-card">
        <p><strong>Submission ID:</strong> {{ submission.submission_id }}</p>
        <p><strong>Assignment Name:</strong> {{ submission.assignment_name }}</p>
        <p><strong>Repo Link:</strong> <a href="{{ submission.repo_link }}">{{ submission.repo_link }}</a></p>
        <p><strong>Submission Time:</strong> {{ submission.submission_time|date:"M d, Y H:i:s" }}</p>
        <p><strong>Status:</strong> <span class="status-{{ submission.status|lower }}">{{ submission.status }}</span></p>

        {% if submission.fastapi_response %}
        <h2>FastAPI Response:</h2>
        <pre class="fastapi-response">{{ submission.fastapi_response|json_script:"fastapi_response_data" }}</pre>
        <script>
            const responseData = JSON.parse(document.getElementById('fastapi_response_data').textContent);
            document.querySelector('.fastapi-response').textContent = JSON.stringify(responseData, null, 2);
        </script>
        {% else %}
        <p>No response from FastAPI yet.</p>
        {% endif %}
    </div>
    {% else %}
    <p>Submission not found.</p>
    {% endif %}

    <p><a href="{% url 'submission_list' %}" class="button">Back to Submission History</a></p>
</div>
{% endblock %}
